/*
Copyright (c) 2007-2008 the OTHER media Limited
Licensed under the BSD license, http://ojay.othermedia.org/license.html
*/
// @require ojay/core-min
(function(m,h,k){var i=m.KEY;var r=function(a){a=a.trim();return a?a.split(/\s+/):[]},o=function(a,b){return a-b},p=function(a){return a&&String(a).toUpperCase().charCodeAt(0)},l=function(c){if(typeof c=='string')c=r(c);return c.map(function(a){var b=null;if(b=i[String(a).toUpperCase()])a=b;if(typeof a=='string')a=p(a);return a}).sort(o)},s=function(c){return c.reduce(function(a,b){switch(b){case i.CONTROL:a.ctrl=true;break;case i.SHIFT:a.shift=true;break;case i.ALT:a.alt=true;break;default:a.keys.push(b)}return a},{keys:[]})},j=function(a){return a.sort(o).join(':')};var q=Ojay.Keyboard=new JS.Singleton({listen:function(a,b,c,e){var g=new n(a,b,c,e);g.enable();return g},isPressed:function(a){return l(a).every(f.method('_8'))}});var n=new JS.Class({initialize:function(a,b,c,e){a=Ojay(a).node;if(e)c=c.bind(e);this._7=l(b);this._4=new m(a,s(this._7),c)},enable:function(){this._2=true;this._4.enable();this._3&&d._5(this);return this},disable:function(){this._2=false;this._4.disable();this._3&&d._9(this);return this},preventDefault:function(){this._3=true;this._2&&d._5(this);return this},allowDefault:function(){this._3=false;this._2&&d._9(this);return this},getSignature:function(){var a=j(this._7);this.getSignature=function(){return a};return a}});q.RuleSet=new JS.Class({initialize:function(a){this._0={};var b,c;for(b in a){c=new n(document,b,a[b]);this._0[c.getSignature()]=c}},forEach:function(a,b){a=Function.from(a);for(var c in this._0)a.call(b||null,this._0[c])},enable:function(){this.forEach('enable');return this},disable:function(){this.forEach('disable');return this},get:function(a){return this._0[j(l(a))]||null},merge:function(b){var c={},e=function(a){c[a.getSignature()]=a};[this,b].forEach({forEach:e});var g=new this.klass({});g._0=c;return g}});var f=new JS.Singleton({_1:[],_b:function(a){if(!this._8(a))this._1.push(a)},_a:function(b){this._1=this._1.filter(function(a){return a!=b})},_8:function(a){return this._1.indexOf(a)!=-1},getSignature:function(){return j(this._1)}});var d=new JS.Singleton({_0:[],_5:function(a){this._0.push(a)},_9:function(b){this._0=this._0.filter(function(a){return a!=b})},_6:function(a,b){if(this._c(b))h.preventDefault(a)},_c:function(a){for(var b=0,c=this._0.length;b<c;b++){if(this._0[b].getSignature()==a)return true}return false}});h.on(k,'keydown',function(a){f._b(a.keyCode);if(YAHOO.env.ua.ie)d._6(a,f.getSignature())});if(!YAHOO.env.ua.ie){h.on(k,'keypress',function(a){d._6(a,f.getSignature())})}h.on(k,'keyup',function(a){f._a(a.keyCode)})})(YAHOO.util.KeyListener,YAHOO.util.Event,document);